@using Domain
@using Microsoft.Web.Mvc;
@using Web.Areas.AnalysisManagement;
@using Web.Areas.OutpostManagement;

@section page_title{
Analysis: Product level information at district level
}

@{
    Html.RenderPartial("_EmptySubNavigation");
    Html.RenderPartial("_EmptySideBar");
}

<script type="text/javascript">

    Ext.onReady(function () {

        var analysisBtnId = window.res.header.navigation.analysisAndReports;
        var analysisBtn = Ext.getCmp(analysisBtnId);
        analysisBtn.toggle(true);
    });

</script>
<script type="text/javascript">
    var allowUserToClearValue = {
        'load': function () {
            //this.insert(0, {Id:'@Guid.Empty', Name:'All'});
        }
    };
    Ext.onReady(function () {
        window.feature = {};
        window.feature.countryOverviewComboId = "Drug-Shop-Level-Combobox-Countries-Id";
        window.feature.regionOverviewComboId = "Drug-Shop-Level-Combobox-Regions-Id";
        window.feature.districtOverviewComboId = "Drug-Shop-Level-Combobox-Districts-Id";

        window.feature.countryStore = Ext.create('Ext.data.Store', {
            remoteSuport: true,
            fields: ['Id', 'Name'],
            proxy: {
                type: 'ajax',
                url: '@Url.RouteUrl(OutpostManagementAreaRegistration.DEFAULT_ROUTE, new { controller = "Region", action = "GetCountries" })',
                reader: {
                    type: 'json',
                    root: 'Countries'
                },
                simpleSortMode: true
            },
            sorters: [
                {
                    property: 'Name',
                    direction: 'ASC'
                }
            ],
            listeners: allowUserToClearValue
        });
        window.feature.regionsStore = Ext.create('Ext.data.Store', {
            fields: ['Id', 'Name'],
            proxy: {
                type: 'ajax',
                url: '@Url.RouteUrl(OutpostManagementAreaRegistration.DEFAULT_ROUTE, new { controller = "District", action = "GetRegions" })',
                reader: {
                    type: 'json',
                    root: 'regions'
                }

            },
            listeners: allowUserToClearValue

        });
        window.feature.districtsStore = Ext.create('Ext.data.Store', {
            fields: ['Id', 'Name'],
            proxy: {
                type: 'ajax',
                url: '@Url.RouteUrl(OutpostManagementAreaRegistration.DEFAULT_ROUTE, new { controller = "Outpost", action = "GetDistricts" })',
                reader: {
                    type: 'json',
                    root: 'Districts'
                }

            },
            listeners: allowUserToClearValue

        });

        window.feature.comboBoxFilters = {};
        window.feature.comboBoxFilters.listeners={
            specialkey: function(field, e){
                if (e.getKey() == e.BACKSPACE) {
                    field.setValue(null);
                    if (field.itemId === window.feature.comboBoxFilters.district.itemId ){
                        window.feature.resetDistrictDependencies();
                    }
    
                    if (field.itemId === window.feature.comboBoxFilters.region.itemId){
                        window.feature.resetRegionDependencies();
                    }
    
                    if (field.itemId === window.feature.comboBoxFilters.country.itemId){
                        window.feature.resetCountryDependencies();
                    }
                }
            }
        };
    
        window.feature.on={
            'select':{
                country:function(combo, record){
                    window.feature.resetRegionDependencies();
                    window.feature.regionsStore.load({
                        params:{
                            countryId: combo.getValue()
                        }
                    });
                },
                region:function(combo, record){
                    window.feature.resetDistrictDependencies();
                    window.feature.districtsStore.load({
                        params:{
                            regionId: combo.getValue()
                        }
                    });
                },
                district:function(combo, record){
                }
            }
        };
    
        window.feature.comboBoxFilters.country = Ext.create('Ext.form.ComboBox', {
            xtype: 'combobox',
            itemId: window.feature.countryOverviewComboId,
            store: window.feature.countryStore,
            displayField: 'Name',
            labelAlign: 'top',
            fieldLabel: 'Selected Country',
            valueField:'Id',
            labelClsExtra: 'combo-label',
            emptyText: 'Selected Country', 
            typeAhead: true,
            listeners:{
                specialkey: window.feature.comboBoxFilters.listeners.specialkey,
                'select': window.feature.on.select.country
            } 
        });
    
        window.feature.comboBoxFilters.region = Ext.create('Ext.form.ComboBox', {
            xtype: 'combobox',
            itemId: window.feature.regionOverviewComboId,
            store: window.feature.regionsStore,
            margin: '0 0 0 20',
            queryMode:'local',
            displayField: 'Name',
            labelAlign: 'top',
            fieldLabel: 'Selected Region',
            valueField:'Id',
            labelClsExtra: 'combo-label',
            emptyText: 'Selected Region', 
            typeAhead: true,
            listeners:{
                specialkey: window.feature.comboBoxFilters.listeners.specialkey,
                'select': window.feature.on.select.region
            } 
        });
        window.feature.comboBoxFilters.district = Ext.create('Ext.form.ComboBox', {
            xtype: 'combobox',
            itemId: window.feature.districtOverviewComboId,
            store: window.feature.districtsStore,
            margin: '0 0 0 20',
            queryMode:'local',
            displayField: 'Name',
            labelAlign: 'top',
            fieldLabel: 'Selected District',
            labelClsExtra: 'combo-label',
            valueField:'Id',
            emptyText: 'Selected District', 
            typeAhead: true,
            listeners:{
                specialkey: window.feature.comboBoxFilters.listeners.specialkey,
                'select': window.feature.on.select.district
            }
        });

        window.feature.resetCountryDependencies = function () {
            window.feature.comboBoxFilters.country.setValue(null);
            window.feature.resetRegionDependencies();
        };

        window.feature.resetRegionDependencies = function () {
            window.feature.comboBoxFilters.region.setValue(null);
            window.feature.resetDistrictDependencies();
        };

        window.feature.resetDistrictDependencies = function () {
            window.feature.comboBoxFilters.district.setValue(null);
        };

        window.feature.container = Ext.create('Ext.container.Container', {
            margin: '45 50 20 20',
            padding: '20 0 0 20',
            autoScroll: true,
            id: 'TopContainer',
            layout: {
                align: 'stretch',
                type: 'hbox'
            },
            items: [{
                xtype: 'container',
                flex: 1,
                layout: {
                    align: 'stretch',
                    type: 'vbox'
                },
                items: [{
                    xtype: 'container',
                    layout: {
                        align: 'stretch',
                        type: 'vbox'
                    },
                    height: 150,
                    items: [
                {
                    xtype: 'container',
                    flex: 1,
                    layout: {
                        type: 'column'
                    },
                    items: [{
                        xtype: 'container',
                        height: 30,
                        width: 30,
                        html: '&nbsp;'
                    }, {
                        xtype: 'label',
                        cls: 'x-title-label',
                        text: 'Information at drug shop level'
                    }]
                }, {
                    xtype: 'container',
                    flex: 1,
                    layout: {
                        type: 'column'
                    },
                    items: [
						{
						    xtype: 'container',
						    height: 30,
						    width: 30,
						    html: '&nbsp;'
						},
                            window.feature.comboBoxFilters.country,
                            window.feature.comboBoxFilters.region,
                            window.feature.comboBoxFilters.district
                        ]
                }]
                }, //window.feature.treegrid
                ]
            }, {
                xtype: 'container',
                flex: 1,
                layout: {
                    align: 'stretch',
                    type: 'vbox'
                },
                padding: '0 0 0 20',
                items: [{
                    xtype: 'container',
                    id: 'DivChartContainer',
                    flex: 2,
                    layout: {
                        align: 'stretch',
                        type: 'vbox'
                    },
                    autoScroll: true,
                    items: []
                }]
            }]
        });

        var contentRes = window.res.content;
        var mainContent = Ext.getCmp(contentRes.maincontent.id);

        mainContent.add(window.feature.container);
        //window.feature.CountryStore.load();
    });
</script>